{% extends "base.html" %}

{% block title %}Add Requirement - Admin Panel{% endblock %}

{% block content %}
<div class="px-4 py-6">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center mb-4">
            <a href="{{ url_for('admin_requirements') }}" class="text-gray-500 hover:text-gray-700 mr-4">
                <i class="fas fa-arrow-left text-lg"></i>
            </a>
            <h1 class="text-3xl font-bold text-gray-900">
                <i class="fas fa-plus text-blue-600 mr-2"></i>
                Add CMMC Requirement
            </h1>
        </div>
        <p class="text-gray-600">Create a new CMMC requirement with detailed specifications and guidance.</p>
    </div>

    <!-- Form -->
    <div class="bg-white shadow-lg rounded-lg">
        <form method="POST" class="space-y-6 p-6">
            <!-- Basic Information -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Basic Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="requirement_id" class="block text-sm font-medium text-gray-700 mb-1">
                            Requirement ID <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="requirement_id" name="requirement_id" required
                               class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                               placeholder="e.g., AC.L1-3.1.1">
                        <p class="text-xs text-gray-500 mt-1">Unique identifier following CMMC format</p>
                    </div>
                    
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-1">
                            Title <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="title" name="title" required
                               class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                               placeholder="Brief descriptive title">
                    </div>
                </div>
            </div>

            <!-- Classification -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Classification</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="level_id" class="block text-sm font-medium text-gray-700 mb-1">
                            CMMC Level <span class="text-red-500">*</span>
                        </label>
                        <select id="level_id" name="level_id" required
                                class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select CMMC Level</option>
                            {% for level in levels %}
                                <option value="{{ level.id }}">Level {{ level.level_number }} - {{ level.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div>
                        <label for="domain_id" class="block text-sm font-medium text-gray-700 mb-1">
                            Security Domain <span class="text-red-500">*</span>
                        </label>
                        <select id="domain_id" name="domain_id" required
                                class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Select Security Domain</option>
                            {% for domain in domains %}
                                <option value="{{ domain.id }}">{{ domain.code }} - {{ domain.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="border-b border-gray-200 pb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Requirement Content</h3>
                <div class="space-y-6">
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">
                            Description <span class="text-red-500">*</span>
                        </label>
                        <textarea id="description" name="description" rows="4" required
                                  class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Detailed description of the requirement..."></textarea>
                        <p class="text-xs text-gray-500 mt-1">Clear and comprehensive description of what this requirement entails</p>
                    </div>
                    
                    <div>
                        <label for="guidance" class="block text-sm font-medium text-gray-700 mb-1">
                            Implementation Guidance
                        </label>
                        <textarea id="guidance" name="guidance" rows="6"
                                  class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                  placeholder="Provide practical guidance on how to implement this requirement..."></textarea>
                        <p class="text-xs text-gray-500 mt-1">Best practices, recommendations, and implementation tips</p>
                    </div>
                </div>
            </div>

            <!-- Preview -->
            <div class="bg-gray-50 rounded-lg p-4">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Preview</h3>
                <div id="preview" class="space-y-3">
                    <div class="flex items-center space-x-2">
                        <span id="preview-id" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            Requirement ID
                        </span>
                        <span id="preview-level" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            Level
                        </span>
                        <span id="preview-domain" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                            Domain
                        </span>
                    </div>
                    <h4 id="preview-title" class="text-lg font-medium text-gray-900">Title will appear here</h4>
                    <p id="preview-description" class="text-gray-600">Description will appear here</p>
                    <div id="preview-guidance" class="text-sm text-gray-500 italic">Guidance will appear here</div>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex justify-end space-x-4 pt-6">
                <a href="{{ url_for('admin_requirements') }}" 
                   class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition duration-200">
                    Cancel
                </a>
                <button type="submit" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-200">
                    <i class="fas fa-save mr-2"></i>Create Requirement
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Live preview functionality
function updatePreview() {
    const id = document.getElementById('requirement_id').value || 'Requirement ID';
    const title = document.getElementById('title').value || 'Title will appear here';
    const description = document.getElementById('description').value || 'Description will appear here';
    const guidance = document.getElementById('guidance').value || 'Guidance will appear here';
    
    const levelSelect = document.getElementById('level_id');
    const domainSelect = document.getElementById('domain_id');
    
    const levelText = levelSelect.options[levelSelect.selectedIndex]?.text || 'Level';
    const domainText = domainSelect.options[domainSelect.selectedIndex]?.text || 'Domain';
    
    document.getElementById('preview-id').textContent = id;
    document.getElementById('preview-level').textContent = levelText;
    document.getElementById('preview-domain').textContent = domainText;
    document.getElementById('preview-title').textContent = title;
    document.getElementById('preview-description').textContent = description;
    document.getElementById('preview-guidance').textContent = guidance;
}

// Add event listeners for live preview
document.getElementById('requirement_id').addEventListener('input', updatePreview);
document.getElementById('title').addEventListener('input', updatePreview);
document.getElementById('description').addEventListener('input', updatePreview);
document.getElementById('guidance').addEventListener('input', updatePreview);
document.getElementById('level_id').addEventListener('change', updatePreview);
document.getElementById('domain_id').addEventListener('change', updatePreview);

// Initialize preview
updatePreview();

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const requiredFields = ['requirement_id', 'title', 'description', 'level_id', 'domain_id'];
    let isValid = true;
    
    requiredFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field.value.trim()) {
            field.classList.add('border-red-500');
            isValid = false;
        } else {
            field.classList.remove('border-red-500');
        }
    });
    
    if (!isValid) {
        e.preventDefault();
        alert('Please fill in all required fields.');
    }
});
</script>
{% endblock %}





